<div id="rss-feed-container">
  <p>Loading latest stories...</p>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const rssUrl = "{{ page.rss_feed }}"; // Pulls the feed from your Markdown Front Matter
    if (!rssUrl) return;

    const container = document.getElementById("rss-feed-container");
    const proxyUrl = "https://api.allorigins.win/get?url=";

    fetch(proxyUrl + encodeURIComponent(rssUrl))
      .then(response => {
        if (response.ok) return response.json();
        throw new Error('Network response was not ok.');
      })
      .then(data => {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(data.contents, "text/xml");
        const items = Array.from(xmlDoc.querySelectorAll("item, entry")).slice(0, 5);
        
        if (items.length === 0) {
          container.innerHTML = "<p>No recent stories found.</p>";
          return;
        }

        let html = '<ul class="rss-list">';
        items.forEach(el => {
          const title = el.querySelector("title").textContent;
          const link = el.querySelector("link").getAttribute("href") || el.querySelector("link").textContent;
          html += `<li><a href="${link}" target="_blank" rel="noopener noreferrer">${title}</a></li>`;
        });
        html += "</ul>";
        container.innerHTML = html;
      })
      .catch(err => {
        container.innerHTML = "<p>Unable to load latest stories at this time.</p>";
        console.error("RSS Fetch Error:", err);
      });
  });
</script>

<style>
  .rss-list { list-style-type: none; padding-left: 0; }
  .rss-list li { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
  .rss-list a { font-weight: 500; text-decoration: none; color: #007bff; }
  .rss-list a:hover { text-decoration: underline; }
</style>